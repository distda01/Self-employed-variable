<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webinar: Self-Employed & Variable Income with Dan DiStefano</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .hero-section {
            position: relative;
            background-image: url('https://images.unsplash.com/photo-1516321318423-f06f85e504b3?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }
        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.85) 0%, rgba(59, 130, 246, 0.85) 100%);
            z-index: 1;
        }
        .hero-content {
            position: relative;
            z-index: 2;
        }
        .form-container, .confirmation-container {
            display: none; /* Hidden by default */
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="main-content">
        <!-- Hero Section -->
        <header class="hero-section text-white py-20 sm:py-28">
            <div class="hero-overlay"></div>
            <div class="hero-content container mx-auto px-6 text-center">
                <h1 class="text-4xl md:text-6xl font-bold leading-tight mb-4">Master Your Mortgage</h1>
                <p class="text-2xl md:text-3xl font-light mb-6">A Webinar on Self-Employed & Variable Income</p>
                <p class="max-w-3xl mx-auto text-lg text-blue-100 mb-10">Join home loan expert Dan DiStefano to learn the keys to securing a mortgage when you're self-employed or have variable income. Gain the confidence you need to achieve your homeownership goals.</p>
                <button id="register-now-btn" class="bg-white text-blue-600 font-bold py-3 px-8 rounded-full text-lg hover:bg-gray-100 transform hover:scale-105 transition-transform duration-300 shadow-lg">
                    Register Now
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-6 py-16">
            
            <!-- Webinar Topics Section -->
            <section class="mb-16">
                <h2 class="text-3xl font-bold text-center mb-10">What You'll Learn</h2>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Cards with webinar topics -->
                    <div class="bg-white p-8 rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300">
                        <h3 class="text-xl font-semibold mb-3 text-blue-700">Defining Self-Employment</h3>
                        <p class="text-gray-600">Understand what qualifies as self-employment, from sole proprietorships and 1099 contractors to partnerships and corporations.</p>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300">
                        <h3 class="text-xl font-semibold mb-3 text-blue-700">Income Stability & Analysis</h3>
                        <p class="text-gray-600">Discover how lenders assess the stability and financial strength of your business to determine future income potential.</p>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300">
                        <h3 class="text-xl font-semibold mb-3 text-blue-700">Navigating Variable Income</h3>
                        <p class="text-gray-600">Learn the requirements for using tips, bonuses, commissions, and overtime to qualify for your home loan.</p>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300">
                        <h3 class="text-xl font-semibold mb-3 text-blue-700">Required Documentation</h3>
                        <p class="text-gray-600">Get a clear list of the documents you'll need, including tax returns, P&L statements, and balance sheets.</p>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300">
                        <h3 class="text-xl font-semibold mb-3 text-blue-700">Handling Declining Income</h3>
                        <p class="text-gray-600">Find out how lenders view a dip in income and what steps you can take to address potential concerns.</p>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-md hover:shadow-lg transition-shadow duration-300">
                        <h3 class="text-xl font-semibold mb-3 text-blue-700">Special Considerations</h3>
                        <p class="text-gray-600">Explore special cases, such as being self-employed for over five years, and what that means for you.</p>
                    </div>
                </div>
            </section>

            <!-- Gemini API Feature Section -->
            <section class="bg-white rounded-xl shadow-lg p-8 md:p-12 mb-16 text-center">
                <h2 class="text-3xl font-bold mb-3">Get Prepared Now</h2>
                <p class="text-lg text-gray-600 max-w-3xl mx-auto mb-6">Not sure what documents you need? Describe your work situation below to get a personalized checklist in seconds.</p>
                <div class="max-w-2xl mx-auto">
                    <textarea id="situation-input" class="w-full p-4 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" placeholder="Example: I'm a freelance graphic designer for 3 years, filing a Schedule C."></textarea>
                    <button id="generate-checklist-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-full text-lg hover:bg-blue-700 transition-colors duration-300 shadow-lg">
                        âœ¨ Generate My Checklist
                    </button>
                </div>
                <div id="checklist-loader" class="hidden mt-6">
                    <div class="loader"></div>
                    <p class="text-gray-600">Generating your personalized checklist...</p>
                </div>
                <div id="checklist-result" class="hidden mt-8 text-left bg-gray-100 p-6 rounded-lg"></div>
            </section>

            <!-- Host Section -->
            <section class="bg-white rounded-xl shadow-lg p-8 md:p-12 mb-16">
                <div class="flex flex-col md:flex-row items-center">
                    <div class="md:w-1/3 text-center mb-6 md:mb-0">
                        <img src="https://i.imgur.com/AsJvH2H.jpeg" alt="Dan DiStefano" class="w-48 h-48 rounded-full mx-auto object-cover shadow-md">
                    </div>
                    <div class="md:w-2/3 md:pl-10">
                        <h2 class="text-3xl font-bold mb-3">About Your Host</h2>
                        <p class="text-2xl font-semibold text-blue-700 mb-2">Daniel DiStefano</p>
                        <p class="text-lg text-gray-600 mb-4">Home Loan Consultant | NMLS #2280243</p>
                        <p class="mb-4">Dan is a dedicated home loan consultant with a passion for helping individuals and families navigate the complexities of the mortgage process. He specializes in assisting self-employed professionals and those with variable income streams, providing clear, actionable advice to turn homeownership dreams into reality.</p>
                        <p class="text-sm text-gray-500">ddistefano@mainstreethl.com | (302) 229-2100</p>
                    </div>
                </div>
            </section>
            
            <!-- Final CTA -->
            <section class="text-center">
                 <h2 class="text-3xl font-bold mb-4">Ready to Secure Your Future?</h2>
                 <p class="text-lg text-gray-600 max-w-2xl mx-auto mb-8">Don't let a complex income situation stand in the way of your dream home. Reserve your spot today and take the first step towards a confident home-buying journey.</p>
                 <button id="final-register-btn" class="bg-blue-600 text-white font-bold py-4 px-10 rounded-full text-xl hover:bg-blue-700 transform hover:scale-105 transition-transform duration-300 shadow-lg">
                    Save My Spot!
                </button>
            </section>

        </main>
    </div>

    <!-- Registration Form Modal -->
    <div id="form-container" class="form-container fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 md:p-12 w-full max-w-lg relative transform transition-all duration-300 scale-95 opacity-0" id="form-modal">
             <button id="close-form-btn" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            <h2 class="text-3xl font-bold text-center mb-2">Register for the Webinar</h2>
            <p class="text-center text-gray-600 mb-8">It's free! You'll receive a Microsoft Teams link via email before the event.</p>
            <form id="registration-form">
                <div class="mb-5">
                    <label for="name" class="block text-gray-700 font-medium mb-2">Full Name</label>
                    <input type="text" id="name" name="name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="mb-8">
                    <label for="email" class="block text-gray-700 font-medium mb-2">Email Address</label>
                    <input type="email" id="email" name="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg text-lg hover:bg-blue-700 transition-colors duration-300">
                    Complete Registration
                </button>
            </form>
        </div>
    </div>

    <!-- Confirmation Message Modal -->
    <div id="confirmation-container" class="confirmation-container fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4">
         <div class="bg-white rounded-2xl shadow-2xl p-8 md:p-12 w-full max-w-lg text-center transform transition-all duration-300 scale-95 opacity-0" id="confirmation-modal">
            <h2 class="text-3xl font-bold text-green-600 mb-4">You're Registered!</h2>
            <p class="text-gray-700 mb-6">Thank you for signing up. A confirmation and the Microsoft Teams meeting link will be sent to your email shortly. We look forward to seeing you there!</p>
            <a id="add-to-calendar" href="#" class="inline-block bg-gray-800 text-white font-bold py-3 px-8 rounded-full text-lg hover:bg-gray-900 transition-colors duration-300 shadow-md">
                Add to Calendar
            </a>
        </div>
    </div>

    <script>
        // --- Modal Control ---
        const registerNowBtn = document.getElementById('register-now-btn');
        const finalRegisterBtn = document.getElementById('final-register-btn');
        const closeFormBtn = document.getElementById('close-form-btn');
        const formContainer = document.getElementById('form-container');
        const formModal = document.getElementById('form-modal');
        const registrationForm = document.getElementById('registration-form');
        const confirmationContainer = document.getElementById('confirmation-container');
        const confirmationModal = document.getElementById('confirmation-modal');

        const openForm = () => {
            formContainer.style.display = 'flex';
            setTimeout(() => {
                formModal.classList.remove('scale-95', 'opacity-0');
                formModal.classList.add('scale-100', 'opacity-100');
            }, 10);
        };

        const closeForm = () => {
            formModal.classList.remove('scale-100', 'opacity-100');
            formModal.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                formContainer.style.display = 'none';
            }, 300);
        };

        registerNowBtn.addEventListener('click', openForm);
        finalRegisterBtn.addEventListener('click', openForm);
        closeFormBtn.addEventListener('click', closeForm);
        formContainer.addEventListener('click', (e) => {
            if (e.target === formContainer) {
                closeForm();
            }
        });

        // --- Form Submission ---
        registrationForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            console.log('Registration Details:', { name, email });
            
            closeForm();
            setTimeout(() => {
                showConfirmation();
            }, 300);
        });

        const showConfirmation = () => {
            setupCalendarLink();
            confirmationContainer.style.display = 'flex';
            setTimeout(() => {
                confirmationModal.classList.remove('scale-95', 'opacity-0');
                confirmationModal.classList.add('scale-100', 'opacity-100');
            }, 10);
            
            setTimeout(() => {
                 closeConfirmation();
            }, 8000);
        };

        const closeConfirmation = () => {
            confirmationModal.classList.remove('scale-100', 'opacity-100');
            confirmationModal.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                confirmationContainer.style.display = 'none';
            }, 300);
        };
        
        confirmationContainer.addEventListener('click', (e) => {
            if (e.target === confirmationContainer) {
                closeConfirmation();
            }
        });

        // --- Add to Calendar Functionality ---
        function setupCalendarLink() {
            const eventDate = new Date();
            eventDate.setMonth(eventDate.getMonth() + 1);
            eventDate.setDate(15);
            eventDate.setHours(14, 0, 0); // 2:00 PM

            const startTime = eventDate.toISOString().replace(/-|:|\.\d\d\d/g, "");
            eventDate.setHours(eventDate.getHours() + 1);
            const endTime = eventDate.toISOString().replace(/-|:|\.\d\d\d/g, "");

            const calendarData = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'BEGIN:VEVENT',
                'URL:' + document.URL,
                'DTSTART:' + startTime,
                'DTEND:' + endTime,
                'SUMMARY:Webinar: Self-Employed & Variable Income',
                'DESCRIPTION:Join home loan expert Dan DiStefano to learn the keys to securing a mortgage. A Microsoft Teams link will be sent via email.',
                'LOCATION:Microsoft Teams (Online)',
                'END:VEVENT',
                'END:VCALENDAR'
            ].join('\\n');

            const calendarLink = document.getElementById('add-to-calendar');
            calendarLink.href = 'data:text/calendar;charset=utf8,' + encodeURIComponent(calendarData);
            calendarLink.download = 'webinar-self-employed-income.ics';
        }

        // --- Gemini API Checklist Generator ---
        const generateBtn = document.getElementById('generate-checklist-btn');
        const situationInput = document.getElementById('situation-input');
        const checklistLoader = document.getElementById('checklist-loader');
        const checklistResult = document.getElementById('checklist-result');

        generateBtn.addEventListener('click', async () => {
            const userInput = situationInput.value;
            if (userInput.trim() === '') {
                checklistResult.innerHTML = '<p class="text-red-500">Please describe your situation first.</p>';
                checklistResult.classList.remove('hidden');
                return;
            }

            checklistLoader.classList.remove('hidden');
            checklistResult.classList.add('hidden');
            generateBtn.disabled = true;

            const prompt = `
You are an expert mortgage consultant specializing in loans for self-employed individuals, based on the content of a webinar titled 'Self Employed & Variable Income'.

A user is asking for a personalized document checklist to prepare for a mortgage application.

Webinar context:
- Sole proprietors file a Schedule C.
- Partnerships (1065s) provide K-1s.
- S-Corps (1120S) provide K-1s.
- C-Corps (1120) don't provide K-1s.
- General requirements include: 2 years of personal and business tax returns (1040s and business returns), a year-to-date Profit & Loss (P&L) statement, and a year-to-date balance sheet.
- If self-employed for over 5 years, only one year of tax returns might be needed.
- Other potential documents: 1099s, bank statements, business license, letter from CPA, business insurance, DBA registration.
- For variable income (tips, bonus, commission, overtime), a 2-year history is usually needed, documented via pay stubs and W2s.

User's situation: "${userInput}"

Based on the user's situation and the webinar context, generate a simple, easy-to-read checklist of documents they will likely need to provide. Format the output as a Markdown list with checkboxes. Do not add any introductory or concluding sentences, just the list.
For example:
- [ ] 2 years of personal tax returns (Form 1040)
- [ ] 2 years of business tax returns (Schedule C)
            `;

            try {
                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiKey = ""; // API key will be handled by the environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    
                    let text = result.candidates[0].content.parts[0].text;
                    // Basic Markdown to HTML conversion for the list
                    text = text.replace(/^- \[ \] /gm, '<li class="flex items-center mb-2"><input type="checkbox" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mr-3" disabled><span>')
                               .replace(/\n/g, '</span></li>');
                    checklistResult.innerHTML = `<h3 class="text-2xl font-bold mb-4 text-center">Your Checklist:</h3><ul class="list-none pl-0">${text}</ul>`;

                } else {
                    throw new Error("Unexpected API response structure.");
                }

            } catch (error) {
                console.error("Error calling Gemini API:", error);
                checklistResult.innerHTML = '<p class="text-red-500">Sorry, we couldn\'t generate your checklist at this time. Please try again later.</p>';
            } finally {
                checklistLoader.classList.add('hidden');
                checklistResult.classList.remove('hidden');
                generateBtn.disabled = false;
            }
        });

    </script>

</body>
</html>
